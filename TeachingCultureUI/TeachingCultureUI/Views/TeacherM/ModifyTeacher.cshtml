
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/layui/layui.js"></script>
    <title>修改教师信息</title>
</head>
<body>
    <form class="layui-form" action="" lay-filter="example" , enctype="multipart/form-data">
        <div class="layui-form-item">
            <label class="layui-form-label">编号</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherId" readonly="readonly" id="TeacherId" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">机构</label>
            <div class="layui-input-inline">
                <select id="OrganId" name="OrganId" class="layui-select-group">
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">姓名</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherName" id="TeacherName" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">对外显示名称</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherOuter" id="TeacherOuter" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">单选框</label>
            <div class="layui-input-block">
                <input type="radio" name="TeacherSex" class="TeacherSex" id="TeacherSex" value="男" title="男" checked="checked">
                <input type="radio" name="TeacherSex" value="女" title="女">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学历</label>
            <div class="layui-input-inline">
                <select id="TeachereducationId" name="TeachereducationId" class="layui-select-group">
                    <option value="">请选择</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">QQ</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherQQ" id="TeacherQQ" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">微信</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherWeChat" id="TeacherWeChat" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div>
            <label class="layui-form-label">地址</label>
            <div class="layui-input-inline" style="margin-left:110px">
                <select name="ProvinceId" id="sheng" lay-filter="sheng">
                    <option value="0">省</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select name="City" id="shi" lay-filter="shi">
                    <option value="0">市</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select name="District" id="qu" lay-filter="qu">
                    <option value="0">区</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherPhone" id="TeacherPhone" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">职称</label>
            <div class="layui-input-block">
                <input type="radio" name="TeacherTitle" id="TeacherTitle" class="TeacherTitle" value="教师" title="教师" checked="checked">
                <input type="radio" name="TeacherTitle" value="助教" title="助教">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">身份证号</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherIDnumber" id="TeacherIDnumber" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">毕业学校:</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherGraduate" id="TeacherGraduate" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">邮箱:</label>
            <div class="layui-input-block">
                <input type="text" style="width:180px" name="TeacherCom" id="TeacherCom" lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">教师资格证:</label>
            <div class="layui-input-block">
                <input type="radio" name="TeacherCard" class="TeacherCard" id="TeacherCard" value="有" title="有" checked="checked">
                <input type="radio" name="TeacherCard" value="无" title="无">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">个人简介</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入内容" name="TeacherResume" id="TeacherResume" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="submit" class="layui-btn" id="login" lay-submit="" onclick="location.href='/TeacherM/TeacherShow'">取消</button>
                <button type="button" class="layui-btn" id="btn">下一步</button>
            </div>
        </div>
    </form>
</body>
</html>
<script>
    function GetOrganId() {
        var $ = layui.$;
        $.ajax({
            url: '@ViewBag.Str/api/OrganMods',
            type: "get",
            async: false,
            dataType: 'json',
            success: function (data) {
                $(data).each(function () {
                    var str = '<option value="' + this.organId + '">' + this.organName + "</option>";
                    $("#OrganId").append(str);
                });
                layui.form.render("select");
            }
        });
    }
    //省
    function Sheng() {
        var $ = layui.jquery;
        var form = layui.form;
        $.ajax({
            url: "@ViewBag.Str/api/Dizhi?id=0",
            type: "get",
            async: false,
            contentType: "application/json",
            success: function (data) {
                var str = "";
                $(data).each(function () {
                    str += "<option value='" + this.siID + "'>" + this.sitesName + "</option>";
                })
                $("#sheng").append(str);
                form.render("select");
            }
        })
    }
    //绑定学历
    function GetTeachereducation() {
        var $ = layui.$;
        $.ajax({
            url: '@ViewBag.Str/api/GetTeachereducations',
            type: "get",
            async: false,
            dataType: 'json',
            success: function (data) {
                $(data).each(function () {
                    var str = '<option value="' + this.teachereducationId + '">' + this.teachereducationName + "</option>";
                    $("#TeachereducationId").append(str);
                });
                layui.form.render("select");
            }
        });
    }
    layui.use(['form', 'upload', 'layer', 'table'], function () {
        var form = layui.form
            , layer = layui.layer
            , upload = layui.upload;
        GetOrganId();
        GetTeachereducation();
        Sheng();
        var $ = layui.$;
        var a = 0;
        var b = 0;
        $.ajax({
            url: '@ViewBag.Str/api/ModifyIdTeacherMod?teacherid=' + @ViewBag.teacherid,           
            type: "get",
            contentType: 'application/json',
            async: false,
            dataType: "json",
            success:
                function (d) {
                    a = d.city;
                    b = d.district;
                    c = d.provinceId;
                    s = d.provinceId;
                    form.val('example', {
                          "TeacherId": d.teacherId
                        , "OrganId": d.organId
                        , "TeacherName": d.teacherName
                        , "TeacherOuter": d.teacherOuter
                        , "TeacherSex": d.teacherSex
                        , "TeachereducationId": d.teachereducationId
                        , "TeacherQQ": d.teacherQQ
                        , "TeacherWeChat": d.teacherWeChat
                        , "ProvinceId": d.provinceId
                        , "City": d.city
                        , "District": d.district
                        , "TeacherPhone": d.teacherPhone
                        , "TeacherTitle": d.teacherTitle
                        , "TeacherIDnumber": d.teacherIDnumber
                        , "TeacherGraduate": d.teacherGraduate
                        , "TeacherCom": d.teacherCom
                        , "TeacherCard": d.teacherCard
                        , "TeacherResume": d.teacherResume
                    });
                    $.ajax({
                        url: "http://localhost:50111/api/GetDizhi?id=" + a,
                        type: "get",
                        contentType: 'application/json',
                        async: true,
                        dataType: "json",
                        success: function (data) {
                            var str = "";
                            $("#shi").empty();
                            $(data).each(function () {
                                str += "<option value='" + this.siID + "'>" + this.sitesName + "</option>";
                            })
                            $("#shi").append(str);
                            form.render("select");

                        }
                    })
                    $.ajax({
                        url: "http://localhost:50111/api/GetDizhi?id=" + b,
                        type: "get",
                        contentType: 'application/json',
                        async: true,
                        dataType: "json",
                        success: function (data) {
                            var str = "";
                            $("#qu").empty();
                            $(data).each(function () {
                                str += "<option value='" + this.siID + "'>" + this.sitesName + "</option>";
                            })
                            $("#qu").append(str);
                            form.render("select");

                        }
                    })
                }
        });

        //市
        form.on('select(sheng)', function (data) {
            var $ = layui.jquery;
            $("#shi").empty();
            $("#shi").append("<option value='0'>市</option>");
            $("#qu").empty();
            form.render("select");
            $("#qu").append("<option value='0'>区</option>");
            if ($("#sheng").val() != 0) {
                $.ajax({
                    url: "@ViewBag.Str/api/Dizhi?id=" + $("#sheng").val(),
                    type: "get",
                    async: false,

                    contentType: "application/json",
                    success: function (data) {
                        var str = "";
                        $(data).each(function () {
                            str += "<option value='" + this.siID + "'>" + this.sitesName + "</option>";
                        })
                        $("#shi").append(str);
                        form.render("select");
                    }
                })
            }
        })
        //区
        form.on('select(shi)', function (data) {
            var $ = layui.jquery;
            $("#qu").empty();
            form.render("select");
            $("#qu").append("<option value='0'>区</option>");
            if ($("#shi").val() != 0) {
                $.ajax({
                    url: "@ViewBag.Str/api/Dizhi?id=" + $("#shi").val(),
                    type: "get",
                    async: false,
                    contentType: "application/json",
                    success: function (data) {
                        var str = "";
                        $(data).each(function () {
                            str += "<option value='" + this.siID + "'>" + this.sitesName + "</option>";
                        })
                        $("#qu").append(str);
                        form.render("select");
                    }
                })
            }

        })
        var $ = layui.$;
        //监听提交
        $('#btn').on('click', function () {
            var obj = {};
            obj.teacherId = Number($("#TeacherId").val());
            obj.organId = Number($("#OrganId").val());
            obj.teacherName = $("#TeacherName").val();
            obj.teacherOuter = $("#TeacherOuter").val();
            obj.teacherSex = Number($(".TeacherSex:checked").val() == "男" ? 1 : 0);
            obj.teachereducationId = Number($("#TeachereducationId").val());
            obj.teacherQQ = $("#TeacherQQ").val();
            obj.teacherWeChat = $("#TeacherWeChat").val();
            obj.provinceId = Number($("#ProvinceId").val());
            obj.city = Number($("#City").val());
            obj.district = Number($("#District").val());
            obj.teacherPhone = $("#TeacherPhone").val();
            obj.teacherTitle = Number($("#TeacherTitle").val() == "教师" ? 1 : 0);
            obj.teacherIDnumber = $("#TeacherIDnumber").val();
            obj.teacherGraduate = $("#TeacherGraduate").val();
            obj.teacherCom = $("#TeacherCom").val();
            obj.teacherCard = Number($("#TeacherCard").val() == "有" ? 1 : 0);
            obj.teacherResume = $("#TeacherResume").val();
            //console.log(obj);
            $.ajax({
                url: "@ViewBag.Str/api/ModifyTeacherMod",
                type: "post",
                contentType: 'application/json',
                data: JSON.stringify(obj),
                success:
                    function (d) {
                        if (d > 0) {
                            layer.msg("修改成功", { icon: 0, time: 1500 });
                            location.href = '/TeacherM/GetTeacher';
                        }
                        else {
                            layer.layer.msg("修改失败", { icon: 0, time: 1500 });
                        }
                    }
            });
        });
        });
</script>